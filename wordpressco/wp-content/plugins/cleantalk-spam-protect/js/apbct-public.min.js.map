{"version":3,"file":"apbct-public.min.js","sources":["apbct-public.js"],"sourcesContent":["(function() {\r\n\r\n\tvar ct_date = new Date(),\r\n\t\tctTimeMs = new Date().getTime(),\r\n\t\tctMouseEventTimerFlag = true, //Reading interval flag\r\n\t\tctMouseData = [],\r\n\t\tctMouseDataCounter = 0;\r\n\r\n\tfunction ctSetCookieSec(c_name, value) {\r\n\t\tdocument.cookie = c_name + \"=\" + encodeURIComponent(value) + \"; path=/; samesite=lax\";\r\n\t}\r\n\r\n\tfunction apbct_attach_event_handler(elem, event, callback){\r\n\t\tif(typeof window.addEventListener === \"function\") elem.addEventListener(event, callback);\r\n\t\telse                                              elem.attachEvent(event, callback);\r\n\t}\r\n\r\n\tfunction apbct_remove_event_handler(elem, event, callback){\r\n\t\tif(typeof window.removeEventListener === \"function\") elem.removeEventListener(event, callback);\r\n\t\telse                                                 elem.detachEvent(event, callback);\r\n\t}\r\n\r\n\tctSetCookieSec(\"ct_ps_timestamp\", Math.floor(new Date().getTime()/1000));\r\n\tctSetCookieSec(\"ct_fkp_timestamp\", \"0\");\r\n\tctSetCookieSec(\"ct_pointer_data\", \"0\");\r\n\tctSetCookieSec(\"ct_timezone\", \"0\");\r\n\r\n\tsetTimeout(function(){\r\n\t\tctSetCookieSec(\"ct_timezone\", ct_date.getTimezoneOffset()/60*(-1));\r\n\t},1000);\r\n\r\n\t//Writing first key press timestamp\r\n\tvar ctFunctionFirstKey = function output(event){\r\n\t\tvar KeyTimestamp = Math.floor(new Date().getTime()/1000);\r\n\t\tctSetCookieSec(\"ct_fkp_timestamp\", KeyTimestamp);\r\n\t\tctKeyStopStopListening();\r\n\t};\r\n\r\n\t//Reading interval\r\n\tvar ctMouseReadInterval = setInterval(function(){\r\n\t\tctMouseEventTimerFlag = true;\r\n\t}, 150);\r\n\r\n\t//Writting interval\r\n\tvar ctMouseWriteDataInterval = setInterval(function(){\r\n\t\tctSetCookieSec(\"ct_pointer_data\", JSON.stringify(ctMouseData));\r\n\t}, 1200);\r\n\r\n\t//Logging mouse position each 150 ms\r\n\tvar ctFunctionMouseMove = function output(event){\r\n\t\tif(ctMouseEventTimerFlag === true){\r\n\r\n\t\t\tctMouseData.push([\r\n\t\t\t\tMath.round(event.clientY),\r\n\t\t\t\tMath.round(event.clientX),\r\n\t\t\t\tMath.round(new Date().getTime() - ctTimeMs)\r\n\t\t\t]);\r\n\r\n\t\t\tctMouseDataCounter++;\r\n\t\t\tctMouseEventTimerFlag = false;\r\n\t\t\tif(ctMouseDataCounter >= 50){\r\n\t\t\t\tctMouseStopData();\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t//Stop mouse observing function\r\n\tfunction ctMouseStopData(){\r\n\t\tapbct_remove_event_handler(window, \"mousemove\", ctFunctionMouseMove);\r\n\t\tclearInterval(ctMouseReadInterval);\r\n\t\tclearInterval(ctMouseWriteDataInterval);\r\n\t}\r\n\r\n\t//Stop key listening function\r\n\tfunction ctKeyStopStopListening(){\r\n\t\tapbct_remove_event_handler(window, \"mousedown\", ctFunctionFirstKey);\r\n\t\tapbct_remove_event_handler(window, \"keydown\", ctFunctionFirstKey);\r\n\t}\r\n\r\n\tapbct_attach_event_handler(window, \"mousemove\", ctFunctionMouseMove);\r\n\tapbct_attach_event_handler(window, \"mousedown\", ctFunctionFirstKey);\r\n\tapbct_attach_event_handler(window, \"keydown\", ctFunctionFirstKey);\r\n\r\n\t// Ready function\r\n\tfunction apbct_ready(){\r\n\r\n\t\tctSetCookieSec(\"apbct_visible_fields\", 0);\r\n\t\tctSetCookieSec(\"apbct_visible_fields_count\", 0);\r\n\r\n\t\tsetTimeout(function(){\r\n\r\n\t\t\tfor(var i = 0; i < document.forms.length; i++){\r\n\t\t\t\tvar form = document.forms[i];\r\n\r\n\t\t\t\t//Exclusion for StoreLocatorPlus form\r\n\t\t\t\tif (form.classList.contains('slp_search_form'))\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\tform.onsubmit_prev = form.onsubmit;\r\n\t\t\t\tform.onsubmit = function(event){\r\n\r\n\t\t\t\t\t// Get only fields\r\n\t\t\t\t\tvar inputs = [],\r\n\t\t\t\t\t\tinputs_visible = '',\r\n\t\t\t\t\t\tinputs_visible_count = 0,\r\n\t\t\t\t\t\tinputs_with_duplicate_names = [];\r\n\r\n\t\t\t\t\tfor(var key in this.elements){\r\n\t\t\t\t\t\tif(!isNaN(+key))\r\n\t\t\t\t\t\t\tinputs[key] = this.elements[key];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Filter fields\r\n\t\t\t\t\tinputs = inputs.filter(function(elem){\r\n\r\n\t\t\t\t\t\t// Filter fields\r\n\t\t\t\t\t\tif( getComputedStyle(elem).display    === \"none\" ||   // hidden\r\n\t\t\t\t\t\t\tgetComputedStyle(elem).visibility === \"hidden\" || // hidden\r\n\t\t\t\t\t\t\tgetComputedStyle(elem).opacity    === \"0\" ||      // hidden\r\n\t\t\t\t\t\t\telem.getAttribute(\"type\")         === \"hidden\" || // type == hidden\r\n\t\t\t\t\t\t\telem.getAttribute(\"type\")         === \"submit\" || // type == submit\r\n\t\t\t\t\t\t\telem.value                        === \"\"       || // empty value\r\n\t\t\t\t\t\t\telem.getAttribute('name')         === null ||\r\n\t\t\t\t\t\t\tinputs_with_duplicate_names.indexOf( elem.getAttribute('name') ) !== -1 // name already added\r\n\t\t\t\t\t\t){\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Visible fields count\r\n\t\t\t\t\t\tinputs_visible_count++;\r\n\r\n\t\t\t\t\t\t// Filter inputs with same names for type == radio\r\n\t\t\t\t\t\tif( -1 !== ['radio', 'checkbox'].indexOf( elem.getAttribute(\"type\") )){\r\n\t\t\t\t\t\t\tinputs_with_duplicate_names.push( elem.getAttribute('name') );\r\n\t\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Visible fields\r\n\t\t\t\t\tinputs.forEach(function(elem, i, elements){\r\n\t\t\t\t\t\tinputs_visible += \" \" + elem.getAttribute(\"name\");\r\n\t\t\t\t\t});\r\n\t\t\t\t\tinputs_visible = inputs_visible.trim();\r\n\r\n\t\t\t\t\tctSetCookieSec(\"apbct_visible_fields\", inputs_visible);\r\n\t\t\t\t\tctSetCookieSec(\"apbct_visible_fields_count\", inputs_visible_count);\r\n\r\n\t\t\t\t\t// Call previous submit action\r\n\t\t\t\t\tif(event.target.onsubmit_prev instanceof Function){\r\n\t\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\t\tevent.target.onsubmit_prev.call(event.target, event);\r\n\t\t\t\t\t\t}, 500);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}, 1000);\r\n\t}\r\n\tapbct_attach_event_handler(window, \"DOMContentLoaded\", apbct_ready);\r\n\r\n}());\r\n\r\nfunction apbct_js_keys__set_input_value(result, data, params, obj){\r\n\tif (document.getElementById(params.input_name) !== null) {\r\n\t\tvar ct_input_value = document.getElementById(params.input_name).value;\r\n\t\tdocument.getElementById(params.input_name).value = document.getElementById(params.input_name).value.replace(ct_input_value, result.js_key);\r\n\t}\r\n}\r\n\r\nif(typeof jQuery !== 'undefined') {\r\n\r\n\t// Capturing responses and output block message for unknown AJAX forms\r\n\tjQuery(document).ajaxComplete(function (event, xhr, settings) {\r\n\t\tif (xhr.responseText && xhr.responseText.indexOf('\"apbct') !== -1) {\r\n\t\t\tvar response = JSON.parse(xhr.responseText);\r\n\t\t\tif (typeof response.apbct !== 'undefined') {\r\n\t\t\t\tresponse = response.apbct;\r\n\t\t\t\tif (response.blocked) {\r\n\t\t\t\t\talert(response.comment);\r\n\t\t\t\t\tif(+response.stop_script == 1)\r\n\t\t\t\t\t\twindow.stop();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tfunction apbct_sendAJAXRequest(data, params, obj) {\r\n\r\n\t\t// Default params\r\n\t\tvar callback = params.callback || null;\r\n\t\tvar notJson = params.notJson || null;\r\n\t\tvar timeout = params.timeout || 15000;\r\n\t\tvar async = params.async || true;\r\n\t\tvar obj = obj || null;\r\n\r\n\t\tif(typeof (data) === 'string') {\r\n\t\t\tdata = data + '&_ajax_nonce=' + ctPublic._ajax_nonce + '&no_cache=' + Math.random();\r\n\t\t}else{\r\n\t\t\tdata._ajax_nonce = ctPublic._ajax_nonce;\r\n\t\t\tdata.no_cache = Math.random();\r\n\t\t}\r\n\r\n\t\tjQuery.ajax({\r\n\t\t\ttype: \"POST\",\r\n\t\t\turl: ctPublic._ajax_url,\r\n\t\t\tdata: data,\r\n\t\t\tasync: async,\r\n\t\t\tsuccess: function (result) {\r\n\t\t\t\tif (!notJson) result = JSON.parse(result);\r\n\t\t\t\tif (result.error) {\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (callback)\r\n\t\t\t\t\t\tcallback(result, data, params, obj);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror: function (jqXHR, textStatus, errorThrown) {\r\n\t\t\t\tconsole.log('APBCT_AJAX_ERROR');\r\n\t\t\t\tconsole.log(data);\r\n\t\t\t\tconsole.log(jqXHR);\r\n\t\t\t\tconsole.log(textStatus);\r\n\t\t\t\tconsole.log(errorThrown);\r\n\t\t\t},\r\n\t\t\ttimeout: timeout\r\n\t\t});\r\n\t}\r\n}"],"names":["apbct_js_keys__set_input_value","result","data","params","obj","ct_input_value","document","getElementById","input_name","value","replace","js_key","apbct_sendAJAXRequest","callback","notJson","timeout","async","ctPublic","_ajax_nonce","Math","random","no_cache","jQuery","ajax","type","url","_ajax_url","success","JSON","parse","error","jqXHR","textStatus","errorThrown","console","log","ct_date","Date","ctTimeMs","getTime","ctMouseEventTimerFlag","ctMouseData","ctMouseDataCounter","ctSetCookieSec","c_name","cookie","encodeURIComponent","apbct_attach_event_handler","elem","event","window","addEventListener","attachEvent","apbct_remove_event_handler","removeEventListener","detachEvent","floor","setTimeout","getTimezoneOffset","ctFunctionFirstKey","ctMouseReadInterval","setInterval","ctMouseWriteDataInterval","stringify","ctFunctionMouseMove","push","round","clientY","clientX","clearInterval","i","forms","length","form","classList","contains","onsubmit_prev","onsubmit","inputs","inputs_visible","inputs_visible_count","inputs_with_duplicate_names","key","this","elements","isNaN","filter","getComputedStyle","display","visibility","opacity","getAttribute","indexOf","forEach","trim","target","Function","call","ajaxComplete","xhr","settings","response","responseText","apbct","blocked","alert","comment","stop_script","stop"],"mappings":"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"}